{
	"name": "dfl_SCD2_generic",
	"properties": {
		"folder": {
			"name": "SCD2"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Param_Src",
						"type": "DatasetReference"
					},
					"name": "srcemployeesrc"
				},
				{
					"dataset": {
						"referenceName": "Param_Table",
						"type": "DatasetReference"
					},
					"name": "srcTarget"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "select1",
					"description": "Renaming srcemployeesrc to select1 with columns 'src_emp_id, src_fname, lname, DOB, salary, mobile, gender, address, city, created_dt, last_update_date'"
				},
				{
					"name": "derivedMd5Hash"
				},
				{
					"name": "filter1"
				},
				{
					"name": "exists1"
				},
				{
					"name": "AddKey"
				},
				{
					"name": "JoinGetMaxIDFromDim"
				},
				{
					"name": "AddTgtMD5Hash"
				},
				{
					"name": "exists2"
				},
				{
					"name": "GetMaxId"
				},
				{
					"name": "DeriveKeyActiveEndDT"
				},
				{
					"name": "SelectNecessaryCol"
				},
				{
					"name": "MarkAsInsert"
				},
				{
					"name": "exists3"
				}
			],
			"scriptLines": [
				"source(output(",
				"          emp_id as integer,",
				"          fname as string,",
				"          lname as string,",
				"          DOB as date,",
				"          salary as double,",
				"          mobile as string,",
				"          gender as string,",
				"          address as string,",
				"          city as string,",
				"          created_dt as timestamp,",
				"          last_update_date as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> srcemployeesrc",
				"source(output(",
				"          emp_key as integer,",
				"          emp_id as integer,",
				"          fname as string,",
				"          lname as string,",
				"          DOB as date,",
				"          mobile as string,",
				"          gender as string,",
				"          address as string,",
				"          city as string,",
				"          Is_active as string,",
				"          create_dt as timestamp,",
				"          ef_start_dt as timestamp,",
				"          ef_end_dt as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> srcTarget",
				"srcemployeesrc select(mapColumn(",
				"          src_emp_id = emp_id,",
				"          src_fname = fname,",
				"          src_lname = lname,",
				"          src_DOB = DOB,",
				"          src_salary = salary,",
				"          src_mobile = mobile,",
				"          src_gender = gender,",
				"          src_address = address,",
				"          src_city = city,",
				"          src_created_dt = created_dt,",
				"          src_last_update_date = last_update_date",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1 derive(md_hash = md5(src_mobile,src_address,src_city)) ~> derivedMd5Hash",
				"srcTarget filter(Is_active == 'Y') ~> filter1",
				"derivedMd5Hash, AddTgtMD5Hash exists(src_emp_id == emp_id",
				"     && md_hash == md_tgt_hash,",
				"     negate:true,",
				"     broadcast: 'auto')~> exists1",
				"exists1 keyGenerate(output(key as long),",
				"     startAt: 1L,",
				"     stepValue: 1L) ~> AddKey",
				"AddKey, GetMaxId join(true(),",
				"     joinType:'cross',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> JoinGetMaxIDFromDim",
				"filter1 derive(md_tgt_hash = md5(mobile,address,city)) ~> AddTgtMD5Hash",
				"AddTgtMD5Hash, derivedMd5Hash exists(emp_id == src_emp_id,",
				"     negate:false,",
				"     broadcast: 'auto')~> exists2",
				"AddTgtMD5Hash aggregate(MaxKey = max(emp_key)) ~> GetMaxId",
				"JoinGetMaxIDFromDim derive(key_tgt = key + MaxKey,",
				"          is_active = 'Y',",
				"          eff_end_dt = toTimestamp('9999-12-31 23:59:00')) ~> DeriveKeyActiveEndDT",
				"DeriveKeyActiveEndDT select(mapColumn(",
				"          src_emp_id,",
				"          src_fname,",
				"          src_lname,",
				"          src_DOB,",
				"          src_salary,",
				"          src_mobile,",
				"          src_gender,",
				"          src_address,",
				"          src_city,",
				"          src_created_dt,",
				"          src_last_update_date,",
				"          key_tgt,",
				"          is_active,",
				"          eff_end_dt",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectNecessaryCol",
				"SelectNecessaryCol alterRow(insertIf(true())) ~> MarkAsInsert",
				"AddTgtMD5Hash, derivedMd5Hash exists(md_tgt_hash == md_hash,",
				"     negate:false,",
				"     broadcast: 'auto')~> exists3"
			]
		}
	}
}